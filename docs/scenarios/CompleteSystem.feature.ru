# language: ru
@ignore
Feature: Полная система модерации чат-бота
  Как модератор чата
  Я хочу иметь полное представление о всех возможностях системы модерации
  Чтобы понимать полный функционал и покрытие тестами

  Background:
    Given система модерации полностью инициализирована
    And все сервисы подключены и работают

  @complete_flow_new_user
  Scenario: Полный флоу нового пользователя
    Given новый пользователь присоединяется к чату
    When система обрабатывает присоединение
    Then должна быть проверена длина имени пользователя
    And должна быть проверена принадлежность к клубу
    And должна быть проверена принадлежность к блэклисту
    And должна быть создана капча для пользователя
    And капча должна содержать приветственное сообщение с правилами
    And таймер автоматического удаления капчи должен быть запущен

    Given пользователь успешно проходит капчу
    When система обрабатывает успешное прохождение
    Then капча должна быть удалена
    And пользователь должен получить приветственное сообщение
    And приветственное сообщение должно быть удалено через 20 секунд
    And пользователь должен получить доступ к отправке сообщений

    Given неодобренный пользователь отправляет первое сообщение
    When система обрабатывает сообщение
    Then пользователь должен получить предупреждение о правилах
    And предупреждение должно быть удалено через 40 секунд
    And сообщение должно пройти полную модерацию
    And счетчик хороших сообщений должен увеличиться

  @complete_flow_message_moderation
  Scenario: Полный флоу модерации сообщений
    Given одобренный пользователь отправляет сообщение
    When система выполняет модерацию
    Then должна быть выполнена проверка блэклиста
    And должна быть выполнена проверка кнопок
    And должна быть выполнена проверка Story
    And должна быть выполнена проверка медиа контента
    And должна быть выполнена проверка известных плохих сообщений
    And должна быть выполнена проверка эмодзи
    And должна быть выполнена проверка look-alike ссылок
    And должна быть выполнена ML классификация
    And результат должен быть возвращен с соответствующим действием

  @complete_flow_blacklist_ban
  Scenario: Полный флоу бана по блэклисту
    Given пользователь из блэклиста отправляет сообщение
    When система обнаруживает пользователя в блэклисте
    Then сообщение должно быть переслано в лог-чат
    And должно быть отправлено уведомление "Автобан по блэклисту lols.bot"
    And сообщение должно быть удалено из чата
    And пользователь должен быть забанен на 4 часа
    And пользователь должен быть удален из списка одобренных
    And статистика должна быть обновлена

  @complete_flow_suspicious_user
  Scenario: Полный флоу подозрительного пользователя
    Given пользователь отправляет первые 3 сообщения
    When система анализирует мимикрию
    Then должен быть рассчитан скор мимикрии
    And если скор >= 0.7, пользователь должен быть помечен как подозрительный
    And администраторы должны получить уведомление
    And должны быть показаны кнопки управления

    Given подозрительный пользователь отправляет дополнительные сообщения
    When система обрабатывает сообщения
    Then счетчик сообщений должен увеличиваться
    And при достижении лимита пользователь должен быть одобрен
    And пользователь должен быть удален из списка подозрительных

  @complete_flow_ai_detection
  Scenario: Полный флоу AI детекта
    Given AI детект включен для подозрительного пользователя
    When пользователь отправляет сообщение
    Then должен быть выполнен специальный AI анализ
    And AI детект должен быть выключен после анализа
    And результат должен быть обработан согласно уверенности AI
    And администраторы должны получить соответствующее уведомление

  @complete_flow_admin_actions
  Scenario: Полный флоу админских действий
    Given администратор получает уведомление о подозрительной активности
    When администратор нажимает кнопку действия
    Then должно быть выполнено соответствующее действие
    And результат должен быть залогирован
    And пользователь должен получить соответствующее уведомление
    And статус пользователя должен быть обновлен

  @complete_flow_error_handling
  Scenario: Полный флоу обработки ошибок
    Given происходит ошибка в системе
    When система обрабатывает ошибку
    Then ошибка должна быть залогирована
    And система должна продолжить работу
    And при критических ошибках администраторы должны быть уведомлены
    And пользователи не должны пострадать от ошибки

  @complete_flow_statistics
  Scenario: Полный флоу статистики
    Given система работает в нескольких чатах
    When происходит событие (бан, капча, одобрение)
    Then статистика должна быть обновлена
    And данные должны быть сохранены
    And отчеты должны быть сгенерированы
    And администраторы должны иметь доступ к статистике

  @complete_flow_configuration
  Scenario: Полный флоу конфигурации
    Given администратор изменяет настройки
    When изменения применяются
    Then новые настройки должны вступить в силу
    And система должна работать согласно новым настройкам
    And изменения должны быть залогированы

  @complete_flow_cleanup
  Scenario: Полный флоу очистки данных
    Given пользователь покидает чат или банится
    When система выполняет очистку
    Then все данные пользователя должны быть удалены
    And кэши должны быть очищены
    And счетчики должны быть сброшены
    And система должна освободить ресурсы

  @complete_flow_performance
  Scenario: Полный флоу производительности
    Given система обрабатывает большое количество сообщений
    When нагрузка увеличивается
    Then система должна продолжать работать стабильно
    And время отклика должно оставаться приемлемым
    And ресурсы должны использоваться эффективно
    And ошибки не должны накапливаться

  @complete_flow_security
  Scenario: Полный флоу безопасности
    Given система подвергается попыткам обхода
    When обнаруживаются подозрительные действия
    Then система должна корректно обработать угрозы
    And администраторы должны быть уведомлены
    And система должна остаться стабильной
    And данные должны быть защищены 