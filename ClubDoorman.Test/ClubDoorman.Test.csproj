<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup>
        <TargetFramework>net9.0</TargetFramework>
        <ImplicitUsings>enable</ImplicitUsings>
        <Nullable>enable</Nullable>
        <InvariantGlobalization>false</InvariantGlobalization>
        <IsPackable>false</IsPackable>
        <IsTestProject>true</IsTestProject>
        <RunTestsInParallel>true</RunTestsInParallel>
        <MaxCpuCount>4</MaxCpuCount>
        <!-- Исключаем demo тесты из обычного запуска -->
        <DefaultTestCaseFilter Condition="'$(IncludeDemoTests)' != 'true'">Category!=demo</DefaultTestCaseFilter>
        <!-- Временно отключаем предупреждения для разработки -->
        <TreatWarningsAsErrors>false</TreatWarningsAsErrors>
        <WarningsAsErrors />
        <WarningsNotAsErrors />
        <NoWarn>CS1998;CS8602;CS8618;CS8604;CS8601;CS8600;CS8625;CS8620;CS0219;CS0414;CS0618;CS0219;NU1603;NU1608</NoWarn>
    </PropertyGroup>

    <ItemGroup>
        <PackageReference Include="coverlet.collector" Version="6.0.4">
          <PrivateAssets>all</PrivateAssets>
          <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
        </PackageReference>
        <PackageReference Include="DotNetEnv" Version="3.0.0" />
        <PackageReference Include="FluentAssertions" Version="6.12.1" />
        <PackageReference Include="Microsoft.NET.Test.Sdk" Version="17.8.0" />
        <PackageReference Include="Moq" Version="4.20.70" />
        <PackageReference Include="NUnit" Version="4.3.2" />
        <PackageReference Include="NUnit3TestAdapter" Version="5.0.0" />
        <PackageReference Include="SpecFlow" Version="3.9.74" />
        <PackageReference Include="SpecFlow.NUnit" Version="3.9.74" />
        <PackageReference Include="SpecFlow.Tools.MsBuild.Generation" Version="3.9.74" />
        <PackageReference Include="Telegram.Bot" Version="22.4.4" />
        <!-- New packages for improved test infrastructure -->
        <PackageReference Include="Bogus" Version="35.4.0" />
        <PackageReference Include="AutoFixture" Version="4.18.1" />
        <PackageReference Include="AutoFixture.AutoMoq" Version="4.18.1" />
        <PackageReference Include="Verify" Version="30.5.0" />
        <PackageReference Include="Verify.NUnit" Version="30.5.0" />
    </ItemGroup>

    <ItemGroup>
        <Using Include="NUnit.Framework" />
    </ItemGroup>

    <ItemGroup>
      <ProjectReference Include="..\ClubDoorman\ClubDoorman.csproj" />
    </ItemGroup>

    <ItemGroup>
        <None Update="test-timeouts.json">
            <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        </None>
        <None Update="specflow.json">
            <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        </None>
    </ItemGroup>

    <ItemGroup>
      <Content Include="TestData\Images\**\*">
        <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      </Content>
    </ItemGroup>

    <!-- Конфигурация для разделения быстрых и медленных тестов -->
    <PropertyGroup>
        <!-- Группы тестов -->
        <FastTests>TestCategory!=slow</FastTests>
        <SlowTests>TestCategory=slow</SlowTests>
        <AllTests>TestCategory!=none</AllTests>
    </PropertyGroup>

    <Target Name="PostBuild" AfterTargets="PostBuildEvent">
        <Exec Command="mkdir -p &quot;$(TargetDir)data&quot;" Condition="'$(OS)' != 'Windows_NT'" />
        <Exec Command="cp -n &quot;$(ProjectDir)../ClubDoorman/data/stop-words.txt&quot; &quot;$(TargetDir)data/stop-words.txt&quot;" Condition="'$(OS)' != 'Windows_NT'" />
        <Exec Command="if not exist &quot;$(TargetDir)data&quot; mkdir &quot;$(TargetDir)data&quot;" Condition="'$(OS)' == 'Windows_NT'" />
        <Exec Command="copy &quot;$(ProjectDir)..\\ClubDoorman\\data\\stop-words.txt&quot; &quot;$(TargetDir)data\\stop-words.txt&quot;" Condition="'$(OS)' == 'Windows_NT'" />
        <Exec Command="cp -n &quot;$(ProjectDir)test-timeouts.json&quot; &quot;$(TargetDir)test-timeouts.json&quot;" Condition="'$(OS)' != 'Windows_NT'" />
        <Exec Command="copy &quot;$(ProjectDir)test-timeouts.json&quot; &quot;$(TargetDir)test-timeouts.json&quot;" Condition="'$(OS)' == 'Windows_NT'" />
    </Target>

</Project>
