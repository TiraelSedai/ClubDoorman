## Антиспам для телеграма

Изначально разрабатывался чтобы решить проблему со спамерами в чатах Вастрик.Клуба, но может использоваться и в чатах других форков, да и просто в любых больших чатах.

### Принцип работы
- Пользователи Клуба с привязанным ботом автоматически добавляются в доверенные
- При эвенте "пользователь вошёл в чат" выдаётся простенькая капча
- Если пользователь уже в доверенных, то все проверки пропускаются
- Если пользователь в известных списках спамеров - нафиг
- Если в сообщении многовато эмодзи - нафиг
- Если в сообщении есть слова, которые маскируются под русские но имеют английские буквы внутри - нафиг. Именно этот аспект сейчас затюнен в основном на русскоязычные чаты и может сработать на нормальные слова из языков которые пишутся кириллицей, но пока что все известные кейсы добавлены в тесты.
- Если в сообщении есть стоп-слова типа "заработок в сети" - нафиг
- Дальше сообщение очищается от эмодзи, пунктуации, диакритиков и скармливается ML. Если ML считает что спам - нафиг.
- Если пользователь написал несколько нормальных сообщений, он добавляется в доверенные - спамеры крайне редко "втираются в доверие" и обычно выдают всё первым-вторым сообщением
- Автоматически бот только удаляет сообщения, банятся пользователи только вручную из админки чтобы снизить урон ложнопозитивных срабатываний
- Если кого-то в чате забанил не бот, в админку приходит уведомление, возможно бот пропустил спам и его стоит добавить в датасет

### Команды админки
Все команды вызываются реплаем на другое сообщение
- /spam - добавляет сообщение в датасет спама
- /ham - добавляет сообщение в датасет не-спама
- /classify - вызывает ML классификатор спам\не спам
- /lookalike - ищет слова, которые маскируются под русские

### Конфиг
Создаём чат-админку, запоминаем ID.
Переменные среды:
- DOORMAN_BOT_API: Токен телеграм бота. Обязательно
- DOORMAN_ADMIN_CHAT: ID чата админки. Обязательно
- DOORMAN_CLUB_SERVICE_TOKEN: Сервис токен для Клуба, создаётся тут: https://vas3k.club/apps/. Если переменная не задана, автоматический аппрув людей из Клуба пропускается.
- DOORMAN_CLUB_URL: Базовый URL для форков Клуба, например https://rationalanswer.club/

#### Спасибо
- https://lols.bot/ за борьбу со спамерами и API для бан-листов (правда мне пока ещё не встречались спамеры которые успешно ими ловятся, но за усилия хвалю)
- https://github.com/umputun/tg-spam/ за некоторые идеи и три четверти датасета

### Translation
If you're willing to do the heavy lifting of translating all the text of this bot to other languages, please let me know first before running headfirst and creating a PR.

