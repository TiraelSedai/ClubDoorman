# Issue: [E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π](https://github.com/momai/ClubDoorman/issues/61)

## –û–ø–∏—Å–∞–Ω–∏–µ
–°–æ–∑–¥–∞–Ω–∏–µ E2E —Ç–µ—Å—Ç–æ–≤ –¥–ª—è AI –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫–æ–≤ FakeTelegram.

## –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- AI –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∞ (ü•∞ —Å–≤–æ–π, ü§ñ –±–∞–Ω, üò∂ –ø—Ä–æ–ø—É—Å–∫)
- –†–∞–±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª–∞—Ö (–±–µ–∑ –∫–∞–ø—á–∏)
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Å–ª–µ AI –∞–Ω–∞–ª–∏–∑–∞
- –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –∞–¥–º–∏–Ω—Å–∫–∏–π —á–∞—Ç

## –ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã
- `ClubDoorman/Services/AiChecks.cs`
- `ClubDoorman/Handlers/CallbackQueryHandler.cs`
- `ClubDoorman/Models/SuspiciousUserInfo.cs`
- `ClubDoorman.Test/Integration/AiAnalysisTests.cs`

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–∫–æ–≤ `MockTelegram`
- –ú–æ–∫–∏ –¥–ª—è AI —Å–µ—Ä–≤–∏—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –∫–Ω–æ–ø–æ–∫

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í—ã—Å–æ–∫–∏–π
## –û—Ü–µ–Ω–∫–∞: 1 –¥–µ–Ω—å 

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ (—á–∞—Å—Ç–∏—á–Ω–æ)

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

#### ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
1. **–°–æ–∑–¥–∞–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ E2E —Ç–µ—Å—Ç–æ–≤** –¥–ª—è AI –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π
   - –ù–æ–≤—ã–π —Ñ–∞–π–ª `AiAnalysisTests.cs` —Å 8 —Ç–µ—Å—Ç–∞–º–∏
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã Step Definitions –≤ `AiAnalysisSteps.cs`
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ using –¥–∏—Ä–µ–∫—Ç–∏–≤—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

2. **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:**
   - ‚úÖ E2E_AI_Analysis_FirstMessage_ShouldTriggerAnalysis
   - ‚úÖ E2E_AI_Analysis_AdminButton_Own_ShouldApproveUser  
   - ‚úÖ E2E_AI_Analysis_AdminButton_Ban_ShouldBanUser
   - ‚úÖ E2E_AI_Analysis_AdminButton_Skip_ShouldSkipUser
   - ‚úÖ E2E_AI_Analysis_Channel_ShouldNotShowCaptcha
   - ‚úÖ E2E_AI_Analysis_RepeatedMessage_ShouldNotTriggerAnalysis
   - ‚úÖ E2E_AI_Analysis_OperationOrder_ShouldBeCorrect
   - ‚úÖ E2E_AI_Analysis_PhotoWithCaption_ShouldIncludePhoto

3. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∏–ø–∞–º–∏ (IAppConfig vs AppConfig)
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å MessageId (readonly —Å–≤–æ–π—Å—Ç–≤–∞)
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –º–µ—Ç–æ–¥–∞–º–∏ ApprovedUsersStorage
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ using –¥–∏—Ä–µ–∫—Ç–∏–≤—ã

#### ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **AI API –æ—à–∏–±–∫–∏** - —Ç–µ—Å—Ç—ã –ø–æ–ª—É—á–∞—é—Ç 401 Unauthorized –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π AI API
2. **–õ–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –æ–∂–∏–¥–∞—é—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
3. **FakeTelegramClient** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã –º–æ–≥—É—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤:
- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** 8
- **–£—Å–ø–µ—à–Ω–æ:** 2 (25%)
- **–°–±–æ–µ–≤:** 6 (75%)
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~6.4 —Å–µ–∫—É–Ω–¥—ã

#### üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–∫–∏ –¥–ª—è AI API –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ API
2. –ò–∑—É—á–∏—Ç—å –ª–æ–≥–∏–∫—É AiChecks –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
3. –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å FakeTelegramClient –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ç–æ
4. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ —Ç–µ—Å—Ç—ã