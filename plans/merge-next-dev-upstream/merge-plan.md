# План мержа с upstream/next-dev

## Текущее состояние
- **Ваша ветка**: `refactor/config-groups-phase2-continuation`
- **Целевая ветка**: `upstream/next-dev`
- **Цель**: Сохранить вашу архитектуру, но получить поведение Мамая

## Анализ различий

### Ваши изменения (архитектурные):
1. **Конфигурационные группы** - Phase 2 завершена
2. **Тестовая инфраструктура** - улучшенная система тестов
3. **Request Objects** - объектная модель для запросов
4. **Legacy cleanup** - архивирование старого кода

### Изменения Мамая (поведенческие):
1. **Удаление service message** (10c256f)
2. **Отключение welcome message** (d3eddd3, 69fe099)
3. **Исправления ML проверок** (c45ee5a)
4. **Исправления spam/hello** (e14b0ce, e430d1b)

## Стратегия мержа

### Этап 1: Создание ветки мержа
```bash
git checkout -b merge/next-dev-upstream-preserve-architecture
```

### Этап 2: Анализ конфликтов
- Сначала выполнить dry-run мержа
- Определить файлы с конфликтами
- Категоризировать конфликты по типам

### Этап 3: Разрешение конфликтов
1. **Конфигурационные файлы** - сохранить вашу структуру
2. **Бизнес-логика** - принять изменения Мамая
3. **Тесты** - сохранить вашу инфраструктуру
4. **Инфраструктурный код** - сохранить ваши улучшения

### Этап 4: Валидация
- Запуск тестов
- Проверка функциональности
- Документирование изменений

## Критические решения

### 1. Welcome Message
- **Мамай**: отключил welcome message
- **Решение**: Принять изменение, но сохранить возможность включения через конфигурацию

### 2. Service Message Deletion
- **Мамай**: исправил удаление service message
- **Решение**: Принять исправление

### 3. ML Checks
- **Мамай**: исправил ML проверки
- **Решение**: Принять исправления, но сохранить вашу тестовую инфраструктуру

## Риски и митигация

### Риски:
1. Потеря архитектурных улучшений
2. Конфликты в тестовой инфраструктуре
3. Регрессии в функциональности

### Митигация:
1. Пошаговый мерж с валидацией
2. Сохранение backup ветки
3. Детальное тестирование после каждого этапа

## Чек-лист мержа

- [ ] Создать ветку мержа
- [ ] Выполнить dry-run
- [ ] Проанализировать конфликты
- [ ] Разрешить конфликты по категориям
- [ ] Запустить тесты
- [ ] Проверить функциональность
- [ ] Документировать изменения
- [ ] Создать PR для review 