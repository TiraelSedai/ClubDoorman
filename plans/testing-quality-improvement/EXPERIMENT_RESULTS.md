# üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞: —É–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

## üéØ –¶–µ–ª—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –º–æ–∂–Ω–æ –ª–∏ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞, —É–¥–∞–ª–∏–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π.

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### –£–¥–∞–ª—ë–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:
1. `IBadMessageManager` ‚Üí `BadMessageManager`
2. `IChatLinkFormatter` ‚Üí `ChatLinkFormatter`
3. `ILoggingConfigurationService` ‚Üí `LoggingConfigurationService`
4. `IServiceChatDispatcher` ‚Üí `ServiceChatDispatcher`
5. `IUserFlowLogger` ‚Üí `UserFlowLogger`
6. `IBotPermissionsService` ‚Üí `BotPermissionsService`

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ DI —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ `Program.cs`
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–±—Ä–∏–∫–∏
- –£–±—Ä–∞–Ω `sealed` –∏–∑ `BadMessageManager`

## ‚ùå –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–Ω–∏–∫–ª–∏

### 1. –ü—Ä–æ–±–ª–µ–º—ã —Å Moq
```
System.NotSupportedException : Type to mock (BadMessageManager) must be an interface, a delegate, or a non-sealed, non-static class.
```

**–ü—Ä–∏—á–∏–Ω–∞:** Moq –Ω–µ –º–æ–∂–µ—Ç –º–æ–∫–∞—Ç—å sealed –∫–ª–∞—Å—Å—ã –∏–ª–∏ –∫–ª–∞—Å—Å—ã –±–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

### 2. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤-–∑–∞–≥–ª—É—à–µ–∫
–ü—Ä–∏—à–ª–æ—Å—å –¥–æ–±–∞–≤–ª—è—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
```csharp
// –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
public UserFlowLogger()
{
    _logger = NullLogger<UserFlowLogger>.Instance;
}
```

### 3. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–±–æ—Ä–æ–∫
–ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `FakeTelegramClient` –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–¥–µ –ø—Ä–∏–≤–µ–ª–∞ –∫ –æ—à–∏–±–∫–∞–º –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–ª–æ —Ö–æ—Ä–æ—à–æ

### 1. –£–ø—Ä–æ—â–µ–Ω–∏–µ DI —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
```csharp
// –ë—ã–ª–æ:
services.AddSingleton<IBadMessageManager, BadMessageManager>();

// –°—Ç–∞–ª–æ:
services.AddSingleton<BadMessageManager>();
```

### 2. –ú–µ–Ω—å—à–µ —Ñ–∞–π–ª–æ–≤
- –£–¥–∞–ª–µ–Ω–æ 6 –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- –ú–µ–Ω—å—à–µ "—à—É–º–∞" –≤ –∫–æ–¥–µ

### 3. –ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- –ú–µ–Ω—å—à–µ —Å–ª–æ—ë–≤ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
- –ü—Ä–æ—â–µ –Ω–∞–π—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

## üìä –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ü–ª—é—Å—ã —É–¥–∞–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤:
- ‚úÖ –ú–µ–Ω—å—à–µ —Ñ–∞–π–ª–æ–≤ –∏ –∫–æ–¥–∞
- ‚úÖ –ü—Ä–æ—â–µ DI —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- ‚úÖ –ú–µ–Ω—å—à–µ "—à—É–º–∞" –≤ –∫–æ–¥–µ

### –ú–∏–Ω—É—Å—ã —É–¥–∞–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤:
- ‚ùå –¢–µ—Å—Ç—ã —Å—Ç–∞–ª–∏ —Å–ª–æ–∂–Ω–µ–µ (–Ω—É–∂–Ω—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã-–∑–∞–≥–ª—É—à–∫–∏)
- ‚ùå Moq —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö—É–∂–µ —Å –∫–ª–∞—Å—Å–∞–º–∏
- ‚ùå –ü–æ—Ç–µ—Ä—è –≥–∏–±–∫–æ—Å—Ç–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚ùå –ü—Ä–∏—à–ª–æ—Å—å "–∫–æ—Å—Ç—ã–ª–∏—Ç—å" –∫–æ–¥ —Ä–∞–¥–∏ —Ç–µ—Å—Ç–æ–≤

## üéØ –í—ã–≤–æ–¥—ã

### 1. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π - –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞
- –û–Ω–∏ –Ω–µ –≤—Ä–µ–¥—è—Ç –ø—Ä–æ–µ–∫—Ç—É
- –ü–æ–º–æ–≥–∞—é—Ç —Ç–µ—Å—Ç–∞–º —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ—â–µ
- –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞—ë—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –ø–æ–ª—å–∑—É –ø—Ä–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö

### 2. Moq + –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã = —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞
- –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ –∏ –Ω–∞–¥—ë–∂–Ω–µ–µ
- –ù–µ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã-–∑–∞–≥–ª—É—à–∫–∏
- –¢–µ—Å—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–æ—Å—Ç—ã–º–∏ –∏ –ø–æ–Ω—è—Ç–Ω—ã–º–∏

### 3. –§–æ–∫—É—Å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö
–í–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –ª—É—á—à–µ —Ä–µ—à–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –≤ Config.cs
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç .env —Ñ–∞–π–ª–∞
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ async –º–µ—Ç–æ–¥—ã –≤ –±–æ–ª—å—à–∏—Ö –∫–ª–∞—Å—Å–∞—Ö

## üîÑ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:
1. **–í–µ—Ä–Ω—É—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã** –¥–ª—è –∫–ª–∞—Å—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∞–∫—Ç–∏–≤–Ω–æ –º–æ–∫–∏—Ä—É—é—Ç—Å—è –≤ —Ç–µ—Å—Ç–∞—Ö
2. **–§–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö** (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, .env, –±–æ–ª—å—à–∏–µ –∫–ª–∞—Å—Å—ã)
3. **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã** (Moq + –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)

### –ß—Ç–æ –ù–ï –¥–µ–ª–∞—Ç—å:
- ‚ùå –£–¥–∞–ª—è—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –±–µ–∑ —Ç—â–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚ùå –ú–µ–Ω—è—Ç—å —Ä–∞–±–æ—Ç–∞—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Ä–∞–¥–∏ "–∫—Ä–∞—Å–æ—Ç—ã"
- ‚ùå –£—Å–ª–æ–∂–Ω—è—Ç—å —Ç–µ—Å—Ç—ã —Ä–∞–¥–∏ —É–ø—Ä–æ—â–µ–Ω–∏—è –∫–æ–¥–∞

## üìù –£—Ä–æ–∫–∏

### 1. –ü—Ä–∞–∫—Ç–∏–∫–∞ –≤–∞–∂–Ω–µ–µ —Ç–µ–æ—Ä–∏–∏
- –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏–∑–±—ã—Ç–æ—á–Ω—ã
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –æ–Ω–∏ –ø–æ–º–æ–≥–∞—é—Ç —Ç–µ—Å—Ç–∞–º —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ—â–µ

### 2. –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ "—á–∏—Å—Ç–æ—Ç—ã"
- –ï—Å–ª–∏ —Ç–µ—Å—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Å–ª–æ–∂–Ω–µ–µ, —ç—Ç–æ –ø–ª–æ—Ö–æ–π –∑–Ω–∞–∫
- –õ—É—á—à–µ –æ—Å—Ç–∞–≤–∏—Ç—å "–ª–∏—à–Ω–∏–µ" –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, —á–µ–º "–∫–æ—Å—Ç—ã–ª–∏—Ç—å" –∫–æ–¥

### 3. –§–æ–∫—É—Å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ - –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞
- –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã: —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞, .env –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –±–æ–ª—å—à–∏–µ –∫–ª–∞—Å—Å—ã

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–í–µ—Ä–Ω—É—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã** –∏ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ —Ä–µ—à–µ–Ω–∏–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –ª–æ–º–∞—é—Ç —Ç–µ—Å—Ç—ã –∏ –º–µ—à–∞—é—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. 