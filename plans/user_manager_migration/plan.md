# План миграции UserManager: архивирование легаси и переименование V2

## Цель
Аккуратно архивировать старую версию UserManager и оставить только V2, переименовав её в UserManager.

## Текущее состояние
- `UserManager.cs` - старая версия (легаси)
- `UserManagerV2.cs` - новая версия (активная)
- В `Program.cs` есть условная регистрация через `Config.UseNewApprovalSystem`
- Все тесты используют интерфейс `IUserManager`, что упрощает миграцию

## План действий

### 1. Архивирование легаси версии
- [ ] Создать папку `archived/` в корне проекта
- [ ] Переместить `ClubDoorman/Services/UserManager.cs` в `archived/UserManager_legacy.cs`
- [ ] Переместить `ClubDoorman/Services/ApprovedUsersStorage.cs` в `archived/ApprovedUsersStorage_legacy.cs` (если используется только старым UserManager)

### 2. Переименование V2 в основную версию
- [ ] Переименовать `UserManagerV2.cs` в `UserManager.cs`
- [ ] Переименовать `ApprovedUsersStorageV2.cs` в `ApprovedUsersStorage.cs`
- [ ] Обновить все внутренние ссылки в коде

### 3. Обновление Program.cs
- [ ] Убрать условную регистрацию
- [ ] Оставить только регистрацию новой версии
- [ ] Удалить проверку `Config.UseNewApprovalSystem`

### 4. Проверка и обновление тестов
- [ ] Проверить, что все тесты используют интерфейс `IUserManager`
- [ ] Убедиться, что нет прямых ссылок на старые классы
- [ ] Запустить тесты для проверки работоспособности

### 5. Очистка конфигурации
- [ ] Удалить переменную окружения `DOORMAN_USE_NEW_APPROVAL_SYSTEM` из Config.cs
- [ ] Обновить документацию

## Риски и меры предосторожности
- Все изменения делаются через git для возможности отката
- Сохраняем легаси версию в archived/ для возможного восстановления
- Тестируем каждый шаг

## Статус
- [x] Начато
- [x] Архивирование завершено
- [x] Переименование завершено
- [x] Тесты проходят
- [x] Завершено 