# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —Å–µ—Ä–≤–∏—Å-—á–∞—Ç–∞–º

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —Å–µ—Ä–≤–∏—Å-—á–∞—Ç–∞–º —Å–æ–≥–ª–∞—Å–Ω–æ [issue #22](https://github.com/momai/ClubDoorman/issues/22).

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **IServiceChatDispatcher** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ —Å–µ—Ä–≤–∏—Å-—á–∞—Ç–æ–≤
2. **ServiceChatDispatcher** - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ —Å –ª–æ–≥–∏–∫–æ–π —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
3. **MessageService** - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞

### –õ–æ–≥–∏–∫–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

#### –ê–¥–º–∏–Ω-—á–∞—Ç (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏)
- `SuspiciousMessageNotificationData` - –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `SuspiciousUserNotificationData` - –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `AiDetectNotificationData` (–∫–æ–≥–¥–∞ `IsAutoDelete = false`) - AI –¥–µ—Ç–µ–∫—Ç, —Ç—Ä–µ–±—É—é—â–∏–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- `PrivateChatBanAttemptData` - –ø–æ–ø—ã—Ç–∫–∏ –±–∞–Ω–∞ –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —á–∞—Ç–µ
- `ChannelMessageNotificationData` - —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–∞–Ω–∞–ª–æ–≤
- `UserRestrictedNotificationData` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
- `UserRemovedFromApprovedNotificationData` - —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö
- `ErrorNotificationData` - –æ—à–∏–±–∫–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è

#### –õ–æ–≥-—á–∞—Ç (–¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤)
- `AutoBanNotificationData` - –∞–≤—Ç–æ–±–∞–Ω—ã
- `AiDetectNotificationData` (–∫–æ–≥–¥–∞ `IsAutoDelete = true`) - AI –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `DOORMAN_ADMIN_CHAT` - ID –∞–¥–º–∏–Ω-—á–∞—Ç–∞
- `DOORMAN_LOG_ADMIN_CHAT` - ID –ª–æ–≥-—á–∞—Ç–∞ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–¥–º–∏–Ω-—á–∞—Ç)

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ DI
```csharp
services.AddSingleton<IServiceChatDispatcher, ServiceChatDispatcher>();
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í MessageService
```csharp
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
if (_serviceChatDispatcher.ShouldSendToAdminChat(data))
{
    await _serviceChatDispatcher.SendToAdminChatAsync(data, cancellationToken);
}
else
{
    await _serviceChatDispatcher.SendToLogChatAsync(data, cancellationToken);
}
```

### –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```csharp
// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –∞–¥–º–∏–Ω-—á–∞—Ç
await _serviceChatDispatcher.SendToAdminChatAsync(notification, cancellationToken);

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –ª–æ–≥-—á–∞—Ç
await _serviceChatDispatcher.SendToLogChatAsync(notification, cancellationToken);
```

## –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

### –ê–¥–º–∏–Ω-—á–∞—Ç
- HTML —Ä–∞–∑–º–µ—Ç–∫–∞
- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π

### –õ–æ–≥-—á–∞—Ç
- HTML —Ä–∞–∑–º–µ—Ç–∫–∞
- –ë–µ–∑ –∫–Ω–æ–ø–æ–∫
- –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

## –ö–Ω–æ–ø–∫–∏ –≤ –∞–¥–º–∏–Ω-—á–∞—Ç–µ

### –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
- ‚ùå –°–ø–∞–º
- üö´ –ë–∞–Ω

### –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
- üö´ –ë–∞–Ω

### AI –¥–µ—Ç–µ–∫—Ç
- ‚úÖ OK
- ‚ùå –°–ø–∞–º

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω—ã unit-—Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è:
- `ServiceChatDispatcherTests.cs` - 8 —Ç–µ—Å—Ç–æ–≤
- –ü–æ–∫—Ä—ã—Ç—ã –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

## –ú–∏–≥—Ä–∞—Ü–∏—è

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
1. –î–æ–±–∞–≤–ª–µ–Ω `IServiceChatDispatcher` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `MessageService`
2. –û–±–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `SendAdminNotificationAsync` –∏ `SendLogNotificationAsync`
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –¥–∏—Å–ø–µ—Ç—á–µ—Ä –≤ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –í–µ—Å—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω
- API `MessageService` –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–ª–∞—Å—å –ø—Ä–µ–∂–Ω–µ–π

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ** - –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ç–∏–ø —á–∞—Ç–∞
2. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞** - –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
3. **–ì–∏–±–∫–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ø–æ–∫—Ä—ã—Ç–æ unit-—Ç–µ—Å—Ç–∞–º–∏
5. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –Ω–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ 