# –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ: –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

**–ò—Å—Ö–æ–¥–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–ø—É—Å–∫–∞–ª–∏—Å—å —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º "DOORMAN_OPENROUTER_API –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω", –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –Ω–∞–ª–∏—á–∏–µ API –∫–ª—é—á–µ–π –≤ `.env` —Ñ–∞–π–ª–µ.

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –≤ `/home/kpblc/projects/ClubDoorman/ClubDoorman.Test/bin/Debug/net9.0/`
- –§–∞–π–ª `.env` –Ω–∞—Ö–æ–¥–∏–ª—Å—è –≤ `/home/kpblc/projects/ClubDoorman/ClubDoorman/.env`
- –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å `.env` –Ω–µ —Ä–∞–±–æ—Ç–∞–ª

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ API –∫–ª—é—á–∞–º–∏
- –í `launchSettings.json` –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `DOORMAN_OPENROUTER_API="test-api-key-for-tests-only"`
- –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–ª –∏ –æ—Ç–∫–ª—é—á–∞–ª AI –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏ –∑–Ω–∞—á–µ–Ω–∏–∏ "test-api-key"

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ù–∞–¥–µ–∂–Ω—ã–π –ø–æ–∏—Å–∫ .env —Ñ–∞–π–ª–∞
```csharp
private string FindEnvFile()
{
    var baseDir = AppContext.BaseDirectory;
    
    // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø—É—Ç–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ AppContext.BaseDirectory
    var possiblePaths = new[]
    {
        Path.Combine(baseDir, "../../../../ClubDoorman/.env"),
        Path.Combine(baseDir, "../../../ClubDoorman/.env"),
        // ... –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
    };
    
    foreach (var path in possiblePaths)
    {
        if (File.Exists(path))
        {
            return path;
        }
    }
    
    throw new FileNotFoundException("Could not find .env file");
}
```

### 2. –£–¥–∞–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö API –∫–ª—é—á–µ–π
- –£–¥–∞–ª–∏–ª `DOORMAN_OPENROUTER_API="test-api-key-for-tests-only"` –∏–∑ `launchSettings.json`
- –ó–∞–º–µ–Ω–∏–ª –Ω–∞ –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —á—Ç–æ–±—ã —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –∏–∑ `.env`

### 3. –°–æ–∑–¥–∞–Ω–∏–µ —É–¥–æ–±–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
```bash
# –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API
./scripts/run_integration_tests.sh
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚ùå –¢–µ—Å—Ç—ã –ø—Ä–æ–ø—É—Å–∫–∞–ª–∏—Å—å: "DOORMAN_OPENROUTER_API –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
- ‚ùå AI –∞–Ω–∞–ª–∏–∑ –æ—Ç–∫–ª—é—á–µ–Ω
- ‚ùå –ù–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å API

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –í—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
- ‚úÖ AI –∞–Ω–∞–ª–∏–∑ –í–ö–õ–Æ–ß–ï–ù: OpenRouter API –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ –†–µ–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å OpenRouter API
- ‚úÖ –ê–Ω–∞–ª–∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ñ–æ—Ç–æ: 708300 –±–∞–π—Ç
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç AI: –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å=0, –ø—Ä–∏—á–∏–Ω–∞=... (—Ä–µ–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑)

## üß™ –†–∞–±–æ—Ç–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã

### 1. EnvironmentTest
- **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `integration`, `environment`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü—Ä–æ—Ö–æ–¥–∏—Ç

### 2. AiChecksPhotoLoggingTest
- **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `integration`, `ai-photo`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¢–µ—Å—Ç AI –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω—ã–π OpenRouter API
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü—Ä–æ—Ö–æ–¥–∏—Ç
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –†–µ–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é —Å–ø–∞–º–∞

## üöÄ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞
```bash
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API
./scripts/run_integration_tests.sh

# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
dotnet test ClubDoorman.Test/ClubDoorman.Test.csproj --filter "Category!=integration"

# –í—Å–µ —Ç–µ—Å—Ç—ã
./scripts/run_tests.sh
```

### –ü—É—Ç–∏ –∫ .env —Ñ–∞–π–ª—É
- `AppContext.BaseDirectory` = `/home/kpblc/projects/ClubDoorman/ClubDoorman.Test/bin/Debug/net9.0/`
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å = `../../../../ClubDoorman/.env`
- 4 —É—Ä–æ–≤–Ω—è –≤–≤–µ—Ä—Ö: `bin/Debug/net9.0/` ‚Üí `ClubDoorman.Test/` ‚Üí `ClubDoorman/` ‚Üí `.env`

## üìà –ú–µ—Ç—Ä–∏–∫–∏

### Unit —Ç–µ—Å—Ç—ã
- **–í—Å–µ–≥–æ**: 604 —Ç–µ—Å—Ç–∞
- **–ü—Ä–æ—Ö–æ–¥—è—Ç**: 600
- **–ü—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è**: 4
- **–ü–∞–¥–∞—é—Ç**: 0
- **–í—Ä–µ–º—è**: ~3.2 —Å–µ–∫—É–Ω–¥—ã

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- **–í—Å–µ–≥–æ**: 3 —Ç–µ—Å—Ç–∞
- **–ü—Ä–æ—Ö–æ–¥—è—Ç**: 3
- **–ü–∞–¥–∞—é—Ç**: 0
- **–í—Ä–µ–º—è**: ~5 —Å–µ–∫—É–Ω–¥ (–≤–∫–ª—é—á–∞—è API –≤—ã–∑–æ–≤—ã)

## üîë –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –Ω—É–∂–Ω—ã:
1. –§–∞–π–ª `ClubDoorman/.env` —Å API –∫–ª—é—á–∞–º–∏
2. `DOORMAN_OPENROUTER_API` - –∫–ª—é—á –¥–ª—è OpenRouter
3. `DOORMAN_BOT_API` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
4. `DOORMAN_ADMIN_CHAT` - ID –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ —á–∞—Ç–∞

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. **–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `./scripts/run_integration_tests.sh`
3. **–î–ª—è CI/CD**: –î–æ–±–∞–≤—å—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—É—é job –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–∞—Å—Ö–æ–¥–æ–º API —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—É—Å–∫–∞—Ö

## üéØ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

- ‚úÖ –†–µ—à–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —É–¥–æ–±–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

## üîÆ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å Telegram API
2. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –¥—Ä—É–≥–∏—Ö AI —Å–µ—Ä–≤–∏—Å–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD pipeline –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ 